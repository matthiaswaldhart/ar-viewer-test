<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Viewer â€” Minimal</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root { --pad: 14px; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: var(--pad);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #fff;
    }
    header { display:flex; align-items:center; justify-content:space-between; margin-bottom: var(--pad); }
    h1 { font-size: 18px; margin: 0; font-weight: 600; }
    .wrap { border-radius: 14px; overflow: hidden; box-shadow: 0 2px 14px rgba(0,0,0,.08); }
    model-viewer { width: 100%; height: 70vh; background: #f7f7f7; display:block; }
    .bar {
      display:flex; gap:10px; align-items:center; justify-content: space-between;
      padding: 10px var(--pad); border: 1px solid #eee; border-top: none; background: #fff;
    }
    button, a.button {
      appearance: none; border: 1px solid #ddd; background: #fff; padding: 10px 14px;
      border-radius: 10px; text-decoration: none; color: #111; font-size: 14px; cursor: pointer;
    }
    .qr { padding: 6px; border: 1px dashed #ddd; border-radius: 10px; background:#fff; }
    .note { font-size: 12px; opacity: .7; }
  </style>
</head>
<body>
  <header>
    <h1>AR Viewer</h1>
  </header>

  <div class="wrap">
    <model-viewer id="mv"
      src="assets/model.glb"
      ios-src="assets/model.usdz"
      ar
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      auto-rotate
      alt="3D model">
    </model-viewer>

    <div class="bar">
      <div style="display:flex; align-items:center; gap:10px;">
        <button id="openAR">Open in AR</button>
        <a id="iosFallback" class="button" href="#" rel="ar" download style="display:none;">Open on iOS</a>
      </div>
      <div class="qr">
        <div id="qrcode"></div>
      </div>
    </div>
  </div>

  <div class="note" style="margin-top:10px;">
    Tip: Place your files at <code>assets/model.glb</code> and <code>assets/model.usdz</code>, or rename these paths in the HTML.
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const mv = document.getElementById('mv');
    const btn = document.getElementById('openAR');
    const iosFallback = document.getElementById('iosFallback');

    // Generate QR for this page
    new QRCode(document.getElementById('qrcode'), {
      text: window.location.href,
      width: 120, height: 120, correctLevel: QRCode.CorrectLevel.M
    });

    // Open AR via model-viewer, fallback link for iOS Quick Look
    const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    const iosSrc = mv.getAttribute('ios-src');

    // Provide a direct Quick Look link if activateAR is not available
    function setFallback() {
      if (isiOS && iosSrc) {
        iosFallback.href = iosSrc;
        iosFallback.style.display = mv.canActivateAR ? 'none' : 'inline-block';
      }
    }
    setTimeout(setFallback, 500);

    btn.addEventListener('click', () => {
      if (mv.canActivateAR) {
        mv.activateAR();
      } else if (isiOS && iosSrc) {
        // Directly open the USDZ in Quick Look if AR activation isn't available
        window.location.href = iosSrc;
      } else {
        alert('AR not available. Try on a mobile device with AR support.');
      }
    });
  </script>
</body>
</html>
